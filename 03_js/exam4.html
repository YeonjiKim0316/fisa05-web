<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Game</title>
    <style>
        body {
            text-align: center;
            margin-top: 50px;
        }
        #targetChar {
            font-size: 50px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        #score {
            font-size: 30px;
            margin-top: 20px;
            cursor: pointer;
        }
        #timer {
            font-size: 20px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    아래 문자를 입력하세요. (소/대문자 구분)
    <div id="targetChar"></div>
    <div id="score">점수: 0</div>
    <div id="timer">남은 시간: 20</div>
    <button id="startButton" onclick="startGame()">Start</button>
    <button id="resetButton" onclick="resetGame()">Reset</button>

    <script>
        // 게임 상태를 관리하는 변수들
        let score = 0;
        let timeLeft = 20;
        let gameInterval;
        let isGameRunning = false; // 게임이 실행 중인지 확인하는 변수

        // DOM 요소 참조
        const targetCharElement = document.getElementById('targetChar');
        const scoreElement = document.getElementById('score');
        const timerElement = document.getElementById('timer');

        // 점수 계산에서 제외할 키 리스트
        const excludedKeys = ['Shift', 'CapsLock'];

        // 랜덤 문자를 생성하는 함수
        function getRandomChar() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            return chars[Math.floor(Math.random() * chars.length)];
        }

        // 새로운 타겟 문자를 설정하는 함수
        function setNewTargetChar() {
            targetCharElement.innerText = getRandomChar();
        }

        // 입력된 문자를 확인하고 점수를 업데이트하는 함수
        function checkInput(event) {
            const inputChar = event.key;

            // CapsLock, Shift 등의 키는 무시
            if (excludedKeys.includes(inputChar)) {
                return;
            }

            // 입력 문자가 타겟 문자와 일치하면 점수 증가, 아니면 점수 감소
            score += (inputChar === targetCharElement.innerText) ? 10 : -5;

            // 업데이트된 점수와 새로운 타겟 문자 표시
            scoreElement.innerText = `점수: ${score}`;
            setNewTargetChar();
        }

        // 타이머를 업데이트하고 시간이 다 되면 게임을 종료하는 함수
        function updateTimer() {
            timeLeft--;
            timerElement.innerText = `남은 시간: ${timeLeft}`;

            if (timeLeft <= 0) {
                endGame();
            }
        }

        // 게임을 종료하고 필요한 정리 작업을 수행하는 함수
        function endGame() {
            clearInterval(gameInterval);
            targetCharElement.innerText = ''; // 타겟 문자 제거
            timerElement.innerText = `시간 초과! 최종 점수: ${score}`;
            document.removeEventListener('keydown', checkInput); // 키 입력 이벤트 제거
            isGameRunning = false; // 게임 실행 상태를 종료로 설정
        }

        // 게임을 초기화하고 시작하는 함수
        function startGame() {
            if (isGameRunning) return; // 게임이 이미 실행 중이면 새로 시작하지 않음
            isGameRunning = true; // 게임 실행 상태를 시작으로 설정

            score = 0;
            timeLeft = 20;
            scoreElement.innerText = `점수: ${score}`;
            timerElement.innerText = `남은 시간: ${timeLeft}`;
            setNewTargetChar(); // 첫 번째 타겟 문자 설정

            gameInterval = setInterval(updateTimer, 1000); // 1초마다 타이머 업데이트
            document.addEventListener('keydown', checkInput); // 키 입력 이벤트 추가
        }

        // 게임을 리셋하는 함수
        function resetGame() {
            clearInterval(gameInterval); // 타이머 정지
            score = 0;
            timeLeft = 20;
            scoreElement.innerText = '점수: 0';
            timerElement.innerText = '남은 시간: 20';
            targetCharElement.innerText = ''; // 타겟 문자 초기화
            document.removeEventListener('keydown', checkInput); // 키 입력 이벤트 제거
            isGameRunning = false; // 게임 실행 상태를 종료로 설정
        }

        // 페이지 로드 시 초기 설정
        function initGame() {
            scoreElement.innerText = '점수: 0';
            timerElement.innerText = '남은 시간: 20';
            targetCharElement.innerText = ''; // 게임 시작 전 타겟 문자 초기화
        }

        // 게임 초기화 함수 호출
        initGame();
    </script>
</body>
</html>