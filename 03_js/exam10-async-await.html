<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>무한 스크롤 예제</title>
    <style>
        /* 기본 스타일 설정 */
        body {
            font-family: Arial, sans-serif;
        }
        #posts {
            max-width: 600px;
            margin: 0 auto;
        }
        .post {
            border: 1px solid #ccc;
            margin: 10px 0;
            padding: 10px;
        }
        .loading {
            text-align: center;
            margin: 20px 0;
            display: none; /* 초기에는 로딩 표시 숨김 */
        }
    </style>
</head>
<body>
    <!-- 포스트를 표시할 컨테이너 -->
    <div id="posts"></div>
    <!-- 로딩 표시기 -->
    <div class="loading" id="loading">로딩 중...</div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM 요소 선택
            const postsContainer = document.getElementById('posts');
            const loading = document.getElementById('loading');
            
            // 페이지 번호 및 요청당 포스트 개수 설정
            let page = 1;
            const limit = 10;
            let isLoading = false; // 중복 요청 방지 플래그

            // API에서 포스트를 가져오는 함수
            const fetchPosts = async (page, limit) => {
                try {
                    const response = await fetch(`https://jsonplaceholder.typicode.com/posts?_page=${page}&_limit=${limit}`);
                    if (!response.ok) throw new Error('네트워크 응답 오류');
                    return await response.json();
                } catch (error) {
                    console.error('포스트 로드 실패:', error);
                    return []; // 오류 발생 시 빈 배열 반환
                }
            };

            // 포스트 데이터를 HTML로 변환 후 화면에 렌더링하는 함수
            const renderPosts = (posts) => {
                postsContainer.innerHTML += posts.map(post => `
                    <div class="post">
                        <h3>${post.title}</h3>
                        <p>${post.body}</p>
                    </div>
                `).join('');
            };

            // 추가 포스트를 불러오는 함수
            const loadMorePosts = async () => {
                if (isLoading) return; // 이미 로딩 중이면 실행하지 않음
                isLoading = true;
                loading.style.display = 'block'; // 로딩 표시기 활성화
                
                const posts = await fetchPosts(page, limit); // 포스트 데이터 가져오기
                renderPosts(posts); // 화면에 렌더링
                
                page++; // 페이지 번호 증가
                isLoading = false;
                loading.style.display = 'none'; // 로딩 표시기 숨김
            };

            // 스크롤 이벤트 리스너 추가: 페이지 하단 근접 시 추가 로드
            window.addEventListener('scroll', () => {
                const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
                if (scrollTop + clientHeight >= scrollHeight - 5) {
                    loadMorePosts();
                }
            });

            // 초기 로드 실행
            loadMorePosts();
        });
    </script>
</body>
</html>
